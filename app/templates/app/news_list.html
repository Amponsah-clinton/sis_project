{% extends 'app/dashboard.html' %}
{% load static %}

{% block content %}
<div style="padding: 2rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h1 style="font-size: 1.5rem; font-weight: 700; color: #111827; margin: 0;">Published blogs</h1>
        <div style="display: flex; align-items: center; gap: 1rem;">
            <span style="color: #6b7280; font-size: 0.875rem;">{{ blogs|length }} Records</span>
            <span style="color: #d1d5db;">|</span>
            <span style="color: #6b7280; font-size: 0.875rem;">Filter page</span>
        </div>
    </div>
    
    <div style="background: white; border-radius: 0.5rem; overflow: hidden; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f9fafb; border-bottom: 1px solid #e5e7eb;">
                    <th style="padding: 1rem; text-align: left; font-size: 0.875rem; font-weight: 600; color: #6b7280; width: 3rem;">#</th>
                    <th style="padding: 1rem; text-align: left; font-size: 0.875rem; font-weight: 600; color: #6b7280; width: 8rem;">Image</th>
                    <th style="padding: 1rem; text-align: left; font-size: 0.875rem; font-weight: 600; color: #6b7280;">Title</th>
                    <th style="padding: 1rem; text-align: left; font-size: 0.875rem; font-weight: 600; color: #6b7280; width: 10rem;">Category</th>
                    <th style="padding: 1rem; text-align: left; font-size: 0.875rem; font-weight: 600; color: #6b7280; width: 12rem;">Date</th>
                    <th style="padding: 1rem; text-align: left; font-size: 0.875rem; font-weight: 600; color: #6b7280; width: 8rem;">Views</th>
                    <th style="padding: 1rem; text-align: left; font-size: 0.875rem; font-weight: 600; color: #6b7280; width: 10rem;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for blog in blogs %}
                <tr style="border-bottom: 1px solid #e5e7eb;">
                    <td style="padding: 1rem; color: #111827; font-size: 0.875rem;">{{ forloop.counter }}</td>
                    <td style="padding: 1rem;">
                        {% if blog.image %}
                            <img src="{{ blog.image.url }}" alt="{{ blog.title }}" style="width: 4rem; height: 4rem; object-fit: cover; border-radius: 0.375rem;">
                        {% else %}
                            <div style="width: 4rem; height: 4rem; background: #f3f4f6; border-radius: 0.375rem; display: flex; align-items: center; justify-content: center; color: #9ca3af;">
                                <i data-lucide="image" style="width: 2rem; height: 2rem;"></i>
                            </div>
                        {% endif %}
                    </td>
                    <td style="padding: 1rem; color: #111827; font-size: 0.875rem; font-weight: 500;">{{ blog.title }}</td>
                    <td style="padding: 1rem;">
                        <span style="background: #eff6ff; color: #1e40af; padding: 0.25rem 0.75rem; border-radius: 0.375rem; font-size: 0.75rem; font-weight: 500; text-transform: capitalize;">
                            {{ blog.get_category_display }}
                        </span>
                    </td>
                    <td style="padding: 1rem; color: #6b7280; font-size: 0.875rem;">{{ blog.formatted_date }}</td>
                    <td style="padding: 1rem; color: #6b7280; font-size: 0.875rem;">{{ blog.views }} views</td>
                    <td style="padding: 1rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <button onclick="viewBlog({{ blog.id }})" style="background: none; border: none; cursor: pointer; color: #22c55e; padding: 0.25rem;" title="View">
                                <i data-lucide="eye" style="width: 1.25rem; height: 1.25rem;"></i>
                            </button>
                            <button onclick="togglePublish({{ blog.id }}, {{ blog.is_published|lower }})" style="background: none; border: none; cursor: pointer; color: {% if blog.is_published %}#22c55e{% else %}#6b7280{% endif %}; padding: 0.25rem;" title="{% if blog.is_published %}Unpublish{% else %}Publish{% endif %}">
                                <i data-lucide="check-circle" style="width: 1.25rem; height: 1.25rem;"></i>
                            </button>
                            <button onclick="deleteBlog({{ blog.id }})" style="background: none; border: none; cursor: pointer; color: #ef4444; padding: 0.25rem;" title="Delete">
                                <i data-lucide="trash-2" style="width: 1.25rem; height: 1.25rem;"></i>
                            </button>
                            <a href="{% url 'app:news_edit' blog.id %}" style="background: none; border: none; cursor: pointer; color: #3b82f6; padding: 0.25rem; text-decoration: none;" title="Edit">
                                <i data-lucide="pencil" style="width: 1.25rem; height: 1.25rem;"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" style="padding: 2rem; text-align: center; color: #6b7280;">No published blogs found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
    
    function viewBlog(blogId) {
        // Open blog in new tab or show details
        window.open('{% url "app:news_list" %}', '_blank');
    }
    
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    
    function togglePublish(blogId, isPublished) {
        const csrftoken = getCookie('csrftoken');
        fetch('{% url "app:news_toggle_publish" 0 %}'.replace('0', blogId), {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': csrftoken
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error updating blog status');
        });
    }
    
    function deleteBlog(blogId) {
        if (confirm('Are you sure you want to delete this blog?')) {
            const csrftoken = getCookie('csrftoken');
            fetch('{% url "app:news_delete" 0 %}'.replace('0', blogId), {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': csrftoken
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error deleting blog');
            });
        }
    }
</script>
{% endblock %}

