{% extends 'app/base.html' %}
{% load static %}

{% block title %}Register Journal - ScholarIndex{% endblock %}

{% block content %}
<style>
  .register-journal-page {
    padding: 2rem 1.5rem 3rem;
    background-color: #f9fafb;
    min-height: calc(100vh - 5rem);
  }

  .register-container {
    max-width: 1000px;
    margin: 0 auto;
  }

  /* Messages Styling */
  .messages-container {
    margin-bottom: 2rem;
  }

  .alert {
    padding: 1rem 1.5rem;
    border-radius: 10px;
    margin-bottom: 1rem;
    font-size: 0.9375rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    animation: slideIn 0.3s ease-out;
    transition: opacity 0.3s ease-out;
  }

  .alert.fade-out {
    opacity: 0;
    transform: translateY(-10px);
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .alert-success {
    background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
    color: #065f46;
    border: 2px solid #10b981;
  }

  .alert-error {
    background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
    color: #991b1b;
    border: 2px solid #ef4444;
  }

  .alert-info {
    background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
    color: #1e40af;
    border: 2px solid #3b82f6;
  }

  .register-form {
    background-color: #ffffff;
    border-radius: 16px;
    padding: 3rem;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    position: relative;
    overflow: hidden;
  }

  .register-form::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
  }

  .form-section {
    margin-bottom: 2.5rem;
  }

  .section-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 1.75rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid #e5e7eb;
    position: relative;
  }

  .section-title::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 60px;
    height: 2px;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
  }

  .form-group {
    margin-bottom: 1.25rem;
  }

  .form-group label {
    display: block;
    font-size: 0.875rem;
    font-weight: 500;
    color: #374151;
    margin-bottom: 0.5rem;
  }

  .form-group label .required {
    color: #ef4444;
    margin-left: 0.25rem;
  }

  .form-row {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.25rem;
  }

  .form-row-3 {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.25rem;
  }

  /* File Upload Styling */
  .file-upload-wrapper {
    border: 2px dashed #d1d5db;
    border-radius: 8px;
    padding: 2.5rem 2rem;
    text-align: center;
    background-color: #f9fafb;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
  }

  .file-upload-wrapper:hover {
    border-color: #3b82f6;
    background-color: #eff6ff;
  }

  .file-upload-wrapper.drag-over {
    border-color: #3b82f6;
    background-color: #dbeafe;
  }

  .file-upload-wrapper.has-file {
    border-color: #10b981;
    background-color: #d1fae5;
  }

  .file-input {
    position: absolute;
    width: 0;
    height: 0;
    opacity: 0;
    overflow: hidden;
  }

  .file-upload-text {
    font-size: 0.9375rem;
    color: #6b7280;
    margin: 0;
  }

  .file-name-display {
    margin-top: 1rem;
    padding: 0.75rem;
    background-color: #ffffff;
    border-radius: 6px;
    font-size: 0.875rem;
    color: #059669;
    font-weight: 500;
    display: none;
  }

  .file-name-display.show {
    display: block;
  }

  /* Input and Select Styling */
  .form-group input[type="text"],
  .form-group input[type="email"],
  .form-group input[type="url"],
  .form-group input[type="number"],
  .form-group select,
  .form-group textarea {
    width: 100%;
    padding: 0.875rem 1.125rem;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 0.9375rem;
    color: #111827;
    background-color: #ffffff;
    transition: all 0.3s ease;
    font-family: inherit;
  }

  .form-group input:hover,
  .form-group select:hover,
  .form-group textarea:hover {
    border-color: #9ca3af;
  }

  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    transform: translateY(-1px);
  }

  .form-group select {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    background-size: 1.5em 1.5em;
    padding-right: 2.5rem;
  }

  .form-group textarea {
    resize: vertical;
    min-height: 120px;
    font-family: inherit;
  }

  /* Radio Button Styling */
  .radio-group {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    margin-top: 0.5rem;
  }

  .radio-option {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .radio-option input[type="radio"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
    accent-color: #3b82f6;
  }

  .radio-option label {
    font-size: 0.9375rem;
    color: #374151;
    margin: 0;
    cursor: pointer;
    font-weight: 400;
  }


  /* Captcha Section */
  .captcha-section {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin: 2rem 0;
    padding: 1.5rem;
    background-color: #f9fafb;
    border-radius: 8px;
  }

  .captcha-image {
    width: 160px;
    height: 70px;
    border: 2px solid #d1d5db;
    border-radius: 6px;
    background-color: #ffffff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Arial', sans-serif;
    font-size: 1.75rem;
    font-weight: 900;
    color: #6b21a8;
    letter-spacing: 0.2em;
    user-select: none;
    position: relative;
    overflow: hidden;
    filter: blur(0.8px);
    text-shadow: 0.5px 0.5px 1px rgba(107, 33, 168, 0.4);
  }

  /* Pink overlay lines and shapes */
  .captcha-image::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
      /* Diagonal lines */
      linear-gradient(45deg, transparent 25%, rgba(236, 72, 153, 0.25) 25%, rgba(236, 72, 153, 0.25) 27%, transparent 27%, transparent 73%, rgba(236, 72, 153, 0.25) 73%, rgba(236, 72, 153, 0.25) 75%, transparent 75%),
      linear-gradient(-45deg, transparent 25%, rgba(236, 72, 153, 0.2) 25%, rgba(236, 72, 153, 0.2) 27%, transparent 27%, transparent 73%, rgba(236, 72, 153, 0.2) 73%, rgba(236, 72, 153, 0.2) 75%, transparent 75%),
      /* Horizontal lines */
      linear-gradient(0deg, transparent 30%, rgba(236, 72, 153, 0.15) 30%, rgba(236, 72, 153, 0.15) 32%, transparent 32%),
      linear-gradient(0deg, transparent 50%, rgba(236, 72, 153, 0.15) 50%, rgba(236, 72, 153, 0.15) 52%, transparent 52%),
      linear-gradient(0deg, transparent 70%, rgba(236, 72, 153, 0.15) 70%, rgba(236, 72, 153, 0.15) 72%, transparent 72%),
      /* Vertical lines */
      linear-gradient(90deg, transparent 20%, rgba(236, 72, 153, 0.15) 20%, rgba(236, 72, 153, 0.15) 22%, transparent 22%),
      linear-gradient(90deg, transparent 50%, rgba(236, 72, 153, 0.15) 50%, rgba(236, 72, 153, 0.15) 52%, transparent 52%),
      linear-gradient(90deg, transparent 80%, rgba(236, 72, 153, 0.15) 80%, rgba(236, 72, 153, 0.15) 82%, transparent 82%);
    pointer-events: none;
    z-index: 2;
  }

  /* Additional overlay shapes */
  .captcha-image::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
      radial-gradient(circle at 20% 30%, rgba(236, 72, 153, 0.2) 1px, transparent 1px),
      radial-gradient(circle at 80% 70%, rgba(236, 72, 153, 0.15) 1px, transparent 1px),
      radial-gradient(circle at 50% 50%, rgba(236, 72, 153, 0.1) 2px, transparent 2px);
    background-size: 30px 30px, 25px 25px, 40px 40px;
    pointer-events: none;
    z-index: 2;
  }

  .captcha-image span {
    position: relative;
    z-index: 1;
    display: inline-block;
    filter: blur(0.6px);
    text-rendering: optimizeSpeed;
  }

  /* Individual character distortion */
  .captcha-image span:nth-child(1) {
    transform: rotate(2deg) translateY(-2px) scaleY(1.1);
    filter: blur(0.5px);
  }

  .captcha-image span:nth-child(2) {
    transform: rotate(-1.5deg) translateY(1px) scaleY(0.95);
    filter: blur(0.7px);
  }

  .captcha-image span:nth-child(3) {
    transform: rotate(1deg) translateY(-1px) scaleY(1.05);
    filter: blur(0.6px);
  }

  .captcha-image span:nth-child(4) {
    transform: rotate(-2deg) translateY(2px) scaleY(0.9);
    filter: blur(0.7px);
  }

  .captcha-image span:nth-child(5) {
    transform: rotate(1.5deg) translateY(-1px) scaleY(1.08);
    filter: blur(0.5px);
  }

  .captcha-input-wrapper {
    flex: 1;
  }

  .captcha-input {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 0.9375rem;
    color: #111827;
    background-color: #ffffff;
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .captcha-input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }

  /* Checkbox Styling */
  .checkbox-group {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    margin: 1.5rem 0;
  }

  .checkbox-group input[type="checkbox"] {
    width: 18px;
    height: 18px;
    margin-top: 0.125rem;
    cursor: pointer;
    accent-color: #3b82f6;
    flex-shrink: 0;
  }

  .checkbox-group label {
    font-size: 0.875rem;
    color: #374151;
    margin: 0;
    cursor: pointer;
    line-height: 1.5;
  }

  /* Submit Button */
  .form-actions {
    display: flex;
    justify-content: center;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid #e5e7eb;
  }

  .btn-submit {
    padding: 0.875rem 2.5rem;
    background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
    color: #ffffff;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: 0 2px 8px rgba(249, 115, 22, 0.3);
  }

  .btn-submit:hover {
    background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%);
    box-shadow: 0 4px 12px rgba(249, 115, 22, 0.4);
    transform: translateY(-1px);
  }

  .btn-submit:active {
    transform: translateY(0);
  }

  .btn-submit svg {
    width: 20px;
    height: 20px;
  }

  .error-message {
    color: #ef4444;
    font-size: 0.875rem;
    margin-top: 0.25rem;
  }

  @media (max-width: 768px) {
    .register-journal-page {
      padding: 1.5rem 1rem;
    }

    .register-form {
      padding: 1.5rem;
    }

    .form-row,
    .form-row-3 {
      grid-template-columns: 1fr;
      gap: 0;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .captcha-section {
      flex-direction: column;
      align-items: stretch;
    }

    .captcha-image {
      width: 100%;
      height: 60px;
    }

    .btn-submit {
      width: 100%;
      justify-content: center;
    }
  }

  @media (max-width: 480px) {
    .register-journal-page {
      padding: 1rem 0.75rem;
    }

    .register-form {
      padding: 1.25rem;
    }
  }
</style>

<div class="register-journal-page">
  <div class="register-container">
    <!-- Page Title -->
    <h1 style="text-align: center; font-size: 2rem; font-weight: 700; color: #111827; margin-bottom: 2rem;">Register Journal</h1>
    
    <!-- Display Messages -->
    {% if messages %}
      <div class="messages-container">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">
            {% if message.tags == 'success' %}
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            {% elif message.tags == 'error' %}
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            {% else %}
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            {% endif %}
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <form class="register-form" method="post" action="{% url 'app:register_journal' %}" enctype="multipart/form-data" id="journalForm">
      {% csrf_token %}

      <!-- Branding Section -->
      <div class="form-section">
        <h2 class="section-title">Branding</h2>

        <!-- Journal Cover Image -->
        <div class="form-group">
          <label>Journal Cover Image <span class="required">*</span></label>
          <div class="file-upload-wrapper" id="coverUploadArea" onclick="document.getElementById('journal_cover_image').click()">
            <input type="file" id="journal_cover_image" name="journal_cover_image" accept="image/*" class="file-input" required onchange="handleFileSelect(event, 'cover')">
            <p class="file-upload-text">Choose files or drag and drop files to upload</p>
            <div class="file-name-display" id="coverFileName"></div>
          </div>
        </div>

        <!-- Journal Logo -->
        <div class="form-group">
          <label>Journal Logo <span class="required">*</span></label>
          <div class="file-upload-wrapper" id="logoUploadArea" onclick="document.getElementById('journal_logo').click()">
            <input type="file" id="journal_logo" name="journal_logo" accept="image/*" class="file-input" required onchange="handleFileSelect(event, 'logo')">
            <p class="file-upload-text">Choose files or drag and drop files to upload</p>
            <div class="file-name-display" id="logoFileName"></div>
          </div>
        </div>

        <!-- Journal Name and Abbreviation -->
        <div class="form-row">
          <div class="form-group">
            <label for="journal_name">Journal Name <span class="required">*</span></label>
            <input type="text" id="journal_name" name="journal_name" placeholder="Enter Journal Name" required>
          </div>

          <div class="form-group">
            <label for="journal_abbreviation">Journal Abbreviation <span class="required">*</span></label>
            <input type="text" id="journal_abbreviation" name="journal_abbreviation" placeholder="Enter Journal Abbreviatio" required>
          </div>
        </div>

        <!-- ISSN Online and Print -->
        <div class="form-row">
          <div class="form-group">
            <label for="issn_online">Issn Online <span class="required">*</span></label>
            <input type="text" id="issn_online" name="issn_online" placeholder="Enter Issn Online" required>
          </div>

          <div class="form-group">
            <label for="issn_print">Issn Print <span class="required">*</span></label>
            <input type="text" id="issn_print" name="issn_print" placeholder="Enter Issn Print" required>
          </div>
        </div>

        <!-- Journal URL -->
        <div class="form-group">
          <label for="journal_url">Journal url <span class="required">*</span></label>
          <input type="url" id="journal_url" name="journal_url" placeholder="Enter Journal url" required>
        </div>

        <!-- Category, Country, Language -->
        <div class="form-row-3">
          <div class="form-group">
            <label for="subject_area">Category <span class="required">*</span></label>
            <select id="subject_area" name="subject_area" required>
              <option value="">Select a value...</option>
              <option value="medicine-health">Medicine and Health</option>
              <option value="technology">Technology</option>
              <option value="engineering">Engineering</option>
              <option value="computer-science">Computer Science</option>
              <option value="art-humanities">Art and Humanities</option>
              <option value="social-science">Social Science and Behavioral Sciences</option>
              <option value="physics">Physics</option>
              <option value="chemistry">Chemistry</option>
              <option value="biology">Biology</option>
            </select>
          </div>

          <div class="form-group">
            <label for="publisher_country">Country <span class="required">*</span></label>
            <select id="publisher_country" name="publisher_country" required>
              <option value="">Select a country...</option>
            </select>
          </div>

          <div class="form-group">
            <label for="language">Language <span class="required">*</span></label>
            <select id="language" name="language" required>
              <option value="">Select a language...</option>
              <option value="English">English</option>
              <option value="Spanish">Spanish</option>
              <option value="French">French</option>
              <option value="German">German</option>
              <option value="Chinese">Chinese</option>
              <option value="Japanese">Japanese</option>
              <option value="Portuguese">Portuguese</option>
              <option value="Russian">Russian</option>
              <option value="Arabic">Arabic</option>
              <option value="Italian">Italian</option>
              <option value="Korean">Korean</option>
              <option value="Dutch">Dutch</option>
              <option value="Swedish">Swedish</option>
              <option value="Polish">Polish</option>
              <option value="Turkish">Turkish</option>
              <option value="Hindi">Hindi</option>
              <option value="Other">Other</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Managerials Section -->
      <div class="form-section">
        <h2 class="section-title">Managerials</h2>

        <div class="form-group">
          <label for="publisher_name">Publisher <span class="required">*</span></label>
          <input type="text" id="publisher_name" name="publisher_name" placeholder="Enter Publisher" required>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="chief_editor_name">Chief Editor <span class="required">*</span></label>
            <input type="text" id="chief_editor_name" name="chief_editor_name" placeholder="Enter Chief Editor" required>
          </div>

          <div class="form-group">
            <label for="chief_editor_email">Chief Editor Email <span class="required">*</span></label>
            <input type="email" id="chief_editor_email" name="chief_editor_email" placeholder="Enter Chief Editor Email" required>
          </div>
        </div>
      </div>

      <!-- Advance Data Section -->
      <div class="form-section">
        <h2 class="section-title">Advance Data</h2>

        <!-- Journal Type and Format -->
        <div class="form-row">
          <div class="form-group">
            <label for="journal_type">Journal Type <span class="required">*</span></label>
            <select id="journal_type" name="journal_type" required>
              <option value="">Select a value...</option>
              <option value="open-access">Open-Access Journal</option>
              <option value="subscription">Subscription-Based Journal</option>
              <option value="hybrid">Hybrid</option>
              <option value="trade">Trade Journal</option>
              <option value="current-affairs">Current affairs/Opinion Magazine</option>
              <option value="popular">Popular Magazine</option>
              <option value="preprint">Pre-Print Journal</option>
            </select>
          </div>

          <div class="form-group">
            <label for="journal_format">Journal Format <span class="required">*</span></label>
            <select id="journal_format" name="journal_format" required>
              <option value="">Select a value...</option>
              <option value="print">Print</option>
              <option value="online">Online</option>
              <option value="both">Both Print and Online</option>
            </select>
          </div>
        </div>

        <!-- Frequency, Publication Fee, Journal Start Year -->
        <div class="form-row-3">
          <div class="form-group">
            <label for="publication_frequency">Frequency <span class="required">*</span></label>
            <input type="text" id="publication_frequency" name="publication_frequency" placeholder="Enter Frequency" required>
          </div>

          <div class="form-group">
            <label for="publication_fee">Publication Fee <span class="required">*</span></label>
            <input type="number" id="publication_fee" name="publication_fee" step="0.01" min="0" placeholder="Enter Publication Fee" required>
          </div>

          <div class="form-group">
            <label for="first_publication_year">Journal Start Year <span class="required">*</span></label>
            <input type="number" id="first_publication_year" name="first_publication_year" placeholder="e.g., 2020" min="1800" max="2025" required>
          </div>
        </div>

        <!-- Open Access Radio -->
        <div class="form-group">
          <label>Open Access <span class="required">*</span></label>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" id="open_access_yes" name="open_access" value="true" checked required>
              <label for="open_access_yes">Yes</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="open_access_no" name="open_access" value="false" required>
              <label for="open_access_no">No</label>
            </div>
          </div>
        </div>

        <!-- Peer Review Radio -->
        <div class="form-group">
          <label>Peer Review <span class="required">*</span></label>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" id="peer_review_yes" name="peer_review" value="true" checked required>
              <label for="peer_review_yes">Yes</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="peer_review_no" name="peer_review" value="false" required>
              <label for="peer_review_no">No</label>
            </div>
          </div>
        </div>

        <!-- Journal Description -->
        <div class="form-group">
          <label for="journal_scope">Journal Description <span class="required">*</span></label>
          <textarea id="journal_scope" name="journal_scope" placeholder="Enter Journal Description" required></textarea>
        </div>
      </div>

      <!-- Captcha Section -->
      <div class="captcha-section">
        <div class="captcha-image" id="captchaImage">
          {% for char in captcha_code|default:"ABCDE" %}
            <span>{{ char }}</span>
          {% endfor %}
        </div>
        <div class="captcha-input-wrapper">
          <input type="text" id="captchaInput" name="captcha_input" class="captcha-input" placeholder="Enter the code" required maxlength="5">
          <div class="error-message" id="captchaError" style="display: none;">Invalid code. Please try again.</div>
        </div>
      </div>

      <!-- Acceptance Checkbox -->
      <div class="checkbox-group">
        <input type="checkbox" id="terms_accepted" name="terms_accepted" required>
        <label for="terms_accepted">
          I accept that the information I have given above is correct. I accept all of the ethical and legal responsibility for the information I provide.
        </label>
      </div>

      <!-- Submit Button -->
      <div class="form-actions">
        <button type="submit" class="btn-submit">
          Submit
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  // Get captcha code from server
  let captchaCode = '{{ captcha_code|default:"ABCDE" }}'.toUpperCase();

  // Update captcha display with individual spans for each character
  function updateCaptchaDisplay(code) {
    const captchaImage = document.getElementById('captchaImage');
    if (!captchaImage) return;
    
    captchaImage.innerHTML = '';
    code = code.toUpperCase();
    
    for (let i = 0; i < code.length; i++) {
      const span = document.createElement('span');
      span.textContent = code[i];
      captchaImage.appendChild(span);
    }
  }

  // Load countries from API
  async function loadCountries() {
    const countrySelect = document.getElementById('publisher_country');
    try {
      const response = await fetch('https://restcountries.com/v3.1/all?fields=name,cca2');
      const countries = await response.json();
      
      // Sort countries alphabetically by name
      countries.sort((a, b) => a.name.common.localeCompare(b.name.common));
      
      // Populate dropdown
      countries.forEach(country => {
        const option = document.createElement('option');
        option.value = country.name.common;
        option.textContent = country.name.common;
        countrySelect.appendChild(option);
      });
    } catch (error) {
      console.error('Error loading countries:', error);
      // Fallback to common countries if API fails
      const fallbackCountries = [
        'United States', 'United Kingdom', 'Canada', 'Australia', 'Germany',
        'France', 'Italy', 'Spain', 'Netherlands', 'Sweden', 'Norway',
        'Denmark', 'Finland', 'Switzerland', 'Belgium', 'Austria', 'Poland',
        'Portugal', 'Ireland', 'New Zealand', 'Japan', 'South Korea',
        'China', 'India', 'Brazil', 'Mexico', 'Argentina', 'South Africa',
        'Singapore', 'Malaysia', 'Thailand', 'Indonesia', 'Philippines'
      ];
      fallbackCountries.forEach(country => {
        const option = document.createElement('option');
        option.value = country;
        option.textContent = country;
        countrySelect.appendChild(option);
      });
    }
  }

  // Load countries when page loads
  document.addEventListener('DOMContentLoaded', function() {
    loadCountries();
    
    // Initialize captcha display
    if (captchaCode) {
      updateCaptchaDisplay(captchaCode);
    }
    
    // Auto-hide messages after 4 seconds
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(function(alert) {
      setTimeout(function() {
        alert.classList.add('fade-out');
        setTimeout(function() {
          alert.remove();
        }, 300); // Remove after fade animation completes
      }, 4000); // 4 seconds
    });
  });

  // File upload handling
  function handleFileSelect(event, type) {
    const file = event.target.files[0];
    const fileNameId = type === 'cover' ? 'coverFileName' : 'logoFileName';
    const uploadAreaId = type === 'cover' ? 'coverUploadArea' : 'logoUploadArea';
    const fileName = document.getElementById(fileNameId);
    const uploadArea = document.getElementById(uploadAreaId);
    
    if (file) {
      fileName.textContent = file.name;
      fileName.classList.add('show');
      uploadArea.classList.add('has-file');
    } else {
      fileName.textContent = '';
      fileName.classList.remove('show');
      uploadArea.classList.remove('has-file');
    }
  }

  // Drag and drop for file uploads
  ['cover', 'logo'].forEach(type => {
    const uploadArea = document.getElementById(type === 'cover' ? 'coverUploadArea' : 'logoUploadArea');
    const fileInput = document.getElementById(type === 'cover' ? 'journal_cover_image' : 'journal_logo');

    uploadArea.addEventListener('dragover', function(e) {
      e.preventDefault();
      uploadArea.classList.add('drag-over');
    });

    uploadArea.addEventListener('dragleave', function(e) {
      e.preventDefault();
      uploadArea.classList.remove('drag-over');
    });

    uploadArea.addEventListener('drop', function(e) {
      e.preventDefault();
      uploadArea.classList.remove('drag-over');
      
      const files = e.dataTransfer.files;
      if (files.length > 0 && files[0].type.startsWith('image/')) {
        fileInput.files = files;
        handleFileSelect({ target: fileInput }, type);
      }
    });
  });

  // Form validation with captcha
  const journalForm = document.getElementById('journalForm');
  if (journalForm) {
    journalForm.addEventListener('submit', function(e) {
      const captchaInput = document.getElementById('captchaInput');
      const captchaError = document.getElementById('captchaError');
      
      if (!captchaInput || !captchaError) return;
      
      const inputValue = captchaInput.value.trim().toUpperCase();
      
      if (inputValue !== captchaCode) {
        e.preventDefault();
        captchaError.style.display = 'block';
        captchaInput.value = '';
        captchaInput.focus();
        return false;
      } else {
        captchaError.style.display = 'none';
      }
    });
  }

  // Refresh captcha on image click - reload page to get new captcha from server
  const captchaImage = document.getElementById('captchaImage');
  if (captchaImage) {
    captchaImage.style.cursor = 'pointer';
    captchaImage.addEventListener('click', function() {
      window.location.reload();
    });
  }
</script>
{% endblock %}
