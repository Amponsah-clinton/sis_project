{% extends 'app/base.html' %}
{% load static %}

{% block title %}Upload Article - ScholarIndex{% endblock %}

{% block content %}
<style>
  .upload-article-page {
    padding: 2rem 1.5rem 3rem;
    background-color: #f9fafb;
    min-height: calc(100vh - 5rem);
  }

  .upload-container {
    max-width: 900px;
    margin: 0 auto;
  }

  .upload-header {
    margin-bottom: 2rem;
  }

  .upload-header h1 {
    font-size: 2rem;
    font-weight: 700;
    color: #111827;
    margin: 0;
  }

  .upload-form {
    background-color: #ffffff;
    border-radius: 12px;
    padding: 2.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-group label {
    display: block;
    font-size: 0.875rem;
    font-weight: 500;
    color: #374151;
    margin-bottom: 0.5rem;
  }

  .form-group label .required {
    color: #ef4444;
    margin-left: 0.25rem;
  }

  .form-hint {
    font-size: 0.75rem;
    color: #6b7280;
    margin-top: 0.375rem;
    font-style: italic;
  }

  /* File Upload Styling */
  .file-upload-wrapper {
    border: 2px dashed #d1d5db;
    border-radius: 8px;
    padding: 2.5rem 2rem;
    text-align: center;
    background-color: #f9fafb;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
  }

  .file-upload-wrapper:hover {
    border-color: #3b82f6;
    background-color: #eff6ff;
  }

  .file-upload-wrapper.drag-over {
    border-color: #3b82f6;
    background-color: #dbeafe;
  }

  .file-upload-wrapper.has-file {
    border-color: #10b981;
    background-color: #d1fae5;
  }

  .file-input {
    position: absolute;
    width: 0;
    height: 0;
    opacity: 0;
    overflow: hidden;
  }

  .file-upload-text {
    font-size: 0.9375rem;
    color: #6b7280;
    margin: 0;
  }

  .file-name-display {
    margin-top: 1rem;
    padding: 0.75rem;
    background-color: #ffffff;
    border-radius: 6px;
    font-size: 0.875rem;
    color: #059669;
    font-weight: 500;
    display: none;
  }

  .file-name-display.show {
    display: block;
  }

  .page-count-display {
    margin-top: 0.5rem;
    padding: 0.5rem 0.75rem;
    background-color: #d1fae5;
    border-radius: 4px;
    font-size: 0.8125rem;
    color: #065f46;
    font-weight: 500;
    display: none;
  }

  .page-count-display.show {
    display: block;
  }

  /* Input and Select Styling */
  .form-group input[type="text"],
  .form-group input[type="number"],
  .form-group select,
  .form-group textarea {
    width: 100%;
    padding: 0.875rem 1rem;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 0.9375rem;
    color: #111827;
    background-color: #ffffff;
    transition: all 0.3s ease;
    font-family: inherit;
  }

  .form-group input:hover,
  .form-group select:hover,
  .form-group textarea:hover {
    border-color: #9ca3af;
  }

  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
  }

  .form-group textarea {
    resize: vertical;
    min-height: 120px;
    font-family: inherit;
  }

  .form-group select {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    background-size: 1.5em 1.5em;
    padding-right: 2.5rem;
  }

  /* Rich Text Editor */
  .rich-text-editor {
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    background-color: #ffffff;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .rich-text-editor:focus-within {
    border-color: #667eea;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
  }

  .rich-text-toolbar {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.5rem 0.75rem;
    background-color: #f9fafb;
    border-bottom: 1px solid #e5e7eb;
    flex-wrap: wrap;
  }

  .toolbar-group {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .toolbar-btn {
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    border-radius: 4px;
    background-color: transparent;
    color: #4b5563;
    cursor: pointer;
    transition: all 0.15s ease;
    font-size: 0.8125rem;
    font-weight: 500;
    padding: 0;
  }

  .toolbar-btn:hover {
    background-color: #e5e7eb;
    color: #111827;
  }

  .toolbar-btn.active {
    background-color: #dbeafe;
    color: #1e40af;
  }

  .toolbar-btn svg {
    width: 14px;
    height: 14px;
  }

  .toolbar-separator {
    width: 1px;
    height: 20px;
    background-color: #d1d5db;
    margin: 0 0.125rem;
    flex-shrink: 0;
  }

  .toolbar-select {
    padding: 0.375rem 1.75rem 0.375rem 0.625rem;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 0.8125rem;
    background-color: #ffffff;
    color: #374151;
    cursor: pointer;
    font-weight: 500;
    min-width: 90px;
    transition: all 0.2s ease;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.5rem center;
    background-size: 1rem 1rem;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
  }

  .toolbar-select:hover {
    background-color: #f9fafb;
    border-color: #9ca3af;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .toolbar-select:focus {
    outline: none;
    background-color: #eff6ff;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1), 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .toolbar-select option {
    padding: 0.5rem;
    background-color: #ffffff;
    color: #111827;
    font-weight: 400;
  }

  .toolbar-select option:checked {
    background-color: #3b82f6;
    color: #ffffff;
    font-weight: 600;
  }

  .toolbar-select option:hover {
    background-color: #f3f4f6;
  }

  .rich-text-content {
    min-height: 300px;
    padding: 1rem;
    border: none;
    outline: none;
    font-size: 0.9375rem;
    line-height: 1.6;
    color: #111827;
    font-family: inherit;
  }

  .rich-text-content:focus {
    outline: none;
  }

  .rich-text-content[data-placeholder]:empty:before {
    content: attr(data-placeholder);
    color: #9ca3af;
  }

  /* Checkbox Styling */
  .checkbox-group {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    margin-top: 1.5rem;
  }

  .checkbox-group input[type="checkbox"] {
    width: 18px;
    height: 18px;
    margin-top: 0.125rem;
    cursor: pointer;
    accent-color: #3b82f6;
    flex-shrink: 0;
  }

  .checkbox-group label {
    font-size: 0.875rem;
    color: #374151;
    margin: 0;
    cursor: pointer;
    line-height: 1.5;
  }

  .checkbox-group a {
    color: #3b82f6;
    text-decoration: none;
  }

  .checkbox-group a:hover {
    text-decoration: underline;
  }

  /* Submit Button */
  .form-actions {
    display: flex;
    justify-content: center;
    margin-top: 2.5rem;
    padding-top: 2rem;
    border-top: 1px solid #e5e7eb;
  }

  .btn-submit {
    padding: 0.875rem 2.5rem;
    background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
    color: #ffffff;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: 0 2px 8px rgba(249, 115, 22, 0.3);
  }

  .btn-submit:hover {
    background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%);
    box-shadow: 0 4px 12px rgba(249, 115, 22, 0.4);
    transform: translateY(-1px);
  }

  .btn-submit:active {
    transform: translateY(0);
  }

  .btn-submit svg {
    width: 20px;
    height: 20px;
  }

  .form-row {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.25rem;
  }

  .form-row-3 {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.25rem;
  }

  @media (max-width: 768px) {
    .upload-article-page {
      padding: 1.5rem 1rem;
    }

    .upload-form {
      padding: 1.5rem;
    }

    .form-row,
    .form-row-3 {
      grid-template-columns: 1fr;
      gap: 0;
    }
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slideOut {
    from {
      opacity: 1;
      transform: translateY(0);
    }
    to {
      opacity: 0;
      transform: translateY(-10px);
    }
  }
</style>

<div class="upload-article-page">
  <div class="upload-container">
    <!-- Messages -->
    {% if messages %}
      <div class="messages-container" style="margin-bottom: 1.5rem;">
        {% for message in messages %}
          <div class="message message-{{ message.tags }}" style="
            padding: 1rem 1.25rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: slideIn 0.3s ease-out;
            {% if message.tags == 'error' %}
              background-color: #fee2e2;
              color: #991b1b;
              border: 1px solid #fecaca;
            {% elif message.tags == 'success' %}
              background-color: #d1fae5;
              color: #065f46;
              border: 1px solid #a7f3d0;
            {% else %}
              background-color: #dbeafe;
              color: #1e40af;
              border: 1px solid #bfdbfe;
            {% endif %}
          ">
            {% if message.tags == 'error' %}
              <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
              </svg>
            {% elif message.tags == 'success' %}
              <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
            {% else %}
              <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>
            {% endif %}
            <span>{{ message }}</span>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="upload-header">
      <h1>Upload Article</h1>
    </div>

    <form class="upload-form" method="post" action="{% url 'app:upload_article' %}" enctype="multipart/form-data" id="articleForm">
      {% csrf_token %}

      <!-- Cover Image -->
      <div class="form-group">
        <label>Corver Image</label>
        <div class="file-upload-wrapper" id="coverUploadArea" onclick="document.getElementById('cover_image').click()">
          <input type="file" id="cover_image" name="cover_image" accept="image/*" class="file-input" onchange="handleFileSelect(event, 'cover')">
          <p class="file-upload-text">Choose files or drag and drop files to upload</p>
          <div class="file-name-display" id="coverFileName"></div>
        </div>
      </div>

      <!-- Upload Article File (moved before Article Title) -->
      <div class="form-group">
        <label>Upload Article File <span class="required">*</span></label>
        <div class="file-upload-wrapper" id="fileUploadArea" onclick="document.getElementById('article_file').click()">
          <input type="file" id="article_file" name="article_file" accept=".pdf,.doc,.docx" required class="file-input" onchange="handleFileSelect(event, 'article')">
          <p class="file-upload-text">Choose files or drag and drop files to upload</p>
          <div class="file-name-display" id="fileName"></div>
          <div class="page-count-display" id="pageCountDisplay"></div>
        </div>
      </div>

      <!-- Article Title -->
      <div class="form-group">
        <label for="title">Article Title <span class="required">*</span></label>
        <textarea id="title" name="title" required placeholder="Enter Article Title" rows="3"></textarea>
      </div>

      <!-- Subject -->
      <div class="form-group">
        <label for="discipline">Subject <span class="required">*</span></label>
        <select id="discipline" name="discipline" required>
          <option value="">Select a value...</option>
          <option value="medicine-health">Medicine and Health</option>
          <option value="technology">Technology</option>
          <option value="engineering">Engineering</option>
          <option value="computer-science">Computer Science</option>
          <option value="art-humanities">Art and Humanities</option>
          <option value="social-science">Social Science and Behavioral Sciences</option>
          <option value="physics">Physics</option>
          <option value="chemistry">Chemistry</option>
          <option value="biology">Biology</option>
        </select>
      </div>

      <!-- Keywords -->
      <div class="form-group">
        <label for="keywords">Keywords <span class="required">*</span></label>
        <input type="text" id="keywords" name="keywords" required placeholder="Key words should be seperated wit">
        <div class="form-hint">Please separet keywords with "," if more than one (e.g education, health, life,...)</div>
      </div>

      <!-- Authors Names -->
      <div class="form-group">
        <label for="authors_names">Authors Names <span class="required">*</span></label>
        <input type="text" id="authors_names" name="authors_names" required placeholder="Names should be seperated wit">
        <div class="form-hint">Please separet Authors names with "," if more than one (e.g John williams, Cynthis addo,...)</div>
      </div>

      <!-- Year Of Publication, Volume, Issue -->
      <div class="form-row-3">
        <div class="form-group">
          <label for="year_of_publication">Year Of Publication <span class="required">*</span></label>
          <input type="number" id="year_of_publication" name="year_of_publication" required min="1900" max="2030" value="2025">
        </div>

        <div class="form-group">
          <label for="volume">Volume <span class="required">*</span></label>
          <input type="text" id="volume" name="volume" required placeholder="Enter Volume">
        </div>

        <div class="form-group">
          <label for="issue">Issue <span class="required">*</span></label>
          <input type="text" id="issue" name="issue" required placeholder="Enter Issue">
        </div>
      </div>

      <!-- Page Numbers -->
      <div class="form-group">
        <label for="pages">Page Numbers <span class="required">*</span></label>
        <input type="text" id="pages" name="pages" required placeholder="Enter Page Numbers">
        <div class="form-hint">e.g 18-29</div>
      </div>

      <!-- Journal Name -->
      <div class="form-group">
        <label for="journal_name">Journal Name <span class="required">*</span></label>
        <input type="text" id="journal_name" name="journal_name" required placeholder="Enter Journal Name">
      </div>

      <!-- Country Of Publication -->
      <div class="form-group">
        <label for="country_of_publication">Country Of Publication <span class="required">*</span></label>
        <select id="country_of_publication" name="country_of_publication" required>
          <option value="">Select a country...</option>
        </select>
      </div>

      <!-- ISSN or DOI -->
      <div class="form-group">
        <label for="issn_or_doi">ISSN or DOI <span class="required">*</span></label>
        <input type="text" id="issn_or_doi" name="issn_or_doi" required placeholder="Enter ISSN or DOI">
      </div>

      <!-- Abstract -->
      <div class="form-group">
        <label for="abstract">Abstract <span class="required">*</span></label>
          <div class="rich-text-editor">
            <div class="rich-text-toolbar">
              <!-- Text Formatting -->
              <div class="toolbar-group">
                <button type="button" class="toolbar-btn" onclick="formatText('bold')" title="Bold (Ctrl+B)">
                  <strong style="font-weight: 700; font-size: 0.875rem;">B</strong>
                </button>
                <button type="button" class="toolbar-btn" onclick="formatText('italic')" title="Italic (Ctrl+I)">
                  <em style="font-style: italic; font-size: 0.875rem;">I</em>
                </button>
                <button type="button" class="toolbar-btn" onclick="formatText('underline')" title="Underline (Ctrl+U)">
                  <u style="text-decoration: underline; font-size: 0.875rem;">U</u>
                </button>
                <button type="button" class="toolbar-btn" onclick="formatText('strikeThrough')" title="Strikethrough">
                  <s style="text-decoration: line-through; font-size: 0.875rem;">S</s>
                </button>
              </div>
              
              <div class="toolbar-separator"></div>
              
              <!-- Font & Size -->
              <div class="toolbar-group">
                <select class="toolbar-select" onchange="formatText('fontName', this.value)">
                  <option value="">Font</option>
                  <option value="Arial">Arial</option>
                  <option value="Times New Roman">Times New Roman</option>
                  <option value="Courier New">Courier New</option>
                  <option value="Georgia">Georgia</option>
                </select>
                <select class="toolbar-select" onchange="formatText('fontSize', this.value)">
                  <option value="">Size</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                </select>
              </div>
              
              <div class="toolbar-separator"></div>
              
              <!-- Colors -->
              <div class="toolbar-group">
                <button type="button" class="toolbar-btn" onclick="setTextColor()" title="Font Color">
                  <span style="position: relative; display: inline-block; font-size: 0.875rem; font-weight: 700; color: #000;">
                    A
                    <span style="position: absolute; bottom: -2px; left: 0; right: 0; height: 3px; background: #000; border-radius: 1px;"></span>
                  </span>
                </button>
                <button type="button" class="toolbar-btn" onclick="setBackgroundColor()" title="Text Highlight Color">
                  <span style="position: relative; display: inline-block; font-size: 0.875rem; font-weight: 700; color: #000; background: #ffff00; padding: 2px 4px; border-radius: 2px;">
                    A
                  </span>
                </button>
              </div>
              
              <div class="toolbar-separator"></div>
              
              <!-- Alignment -->
              <div class="toolbar-group">
                <button type="button" class="toolbar-btn" onclick="formatText('justifyLeft')" title="Align Left">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                    <path d="M3 4h18M3 8h18M3 12h12M3 16h18M3 20h18"/>
                  </svg>
                </button>
                <button type="button" class="toolbar-btn" onclick="formatText('justifyCenter')" title="Align Center">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                    <path d="M3 4h18M6 8h12M3 12h18M6 16h12M3 20h18"/>
                  </svg>
                </button>
                <button type="button" class="toolbar-btn" onclick="formatText('justifyRight')" title="Align Right">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                    <path d="M3 4h18M9 8h12M3 12h18M9 16h12M3 20h18"/>
                  </svg>
                </button>
                <button type="button" class="toolbar-btn" onclick="formatText('justifyFull')" title="Justify">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                    <path d="M3 4h18M3 8h18M3 12h18M3 16h18M3 20h18"/>
                  </svg>
                </button>
              </div>
              
              <div class="toolbar-separator"></div>
              
              <!-- Lists & Indent -->
              <div class="toolbar-group">
                <button type="button" class="toolbar-btn" onclick="formatText('insertUnorderedList')" title="Bullets">
                  <svg fill="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                    <circle cx="4" cy="6" r="1.5"/>
                    <circle cx="4" cy="12" r="1.5"/>
                    <circle cx="4" cy="18" r="1.5"/>
                    <path d="M8 6h13M8 12h13M8 18h13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </button>
                <button type="button" class="toolbar-btn" onclick="formatText('insertOrderedList')" title="Numbering">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                    <path d="M3 6h1v4h-1V6zM3 12h1v4h-1v-4zM3 18h1v4h-1v-4z" fill="currentColor"/>
                    <path d="M8 6h13M8 12h13M8 18h13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </button>
                <button type="button" class="toolbar-btn" onclick="formatText('outdent')" title="Decrease Indent">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                    <path d="M3 6h18M3 12h18M3 18h18" stroke-width="2" stroke-linecap="round"/>
                    <path d="M3 6l3 3-3 3M3 18l3-3-3-3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
                <button type="button" class="toolbar-btn" onclick="formatText('indent')" title="Increase Indent">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                    <path d="M3 6h18M3 12h18M3 18h18" stroke-width="2" stroke-linecap="round"/>
                    <path d="M21 6l-3 3 3 3M21 18l-3-3 3-3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
              
              <div class="toolbar-separator"></div>
              
              <!-- Links & Media -->
              <div class="toolbar-group">
                <button type="button" class="toolbar-btn" onclick="insertLink()" title="Insert Link">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                  </svg>
                </button>
                <div style="position: relative; display: inline-block;">
                  <button type="button" class="toolbar-btn" onclick="openImageDialog()" oncontextmenu="event.preventDefault(); insertImage();" title="Insert Picture (Click for local upload, Right-click for URL)">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                      <rect x="3" y="3" width="18" height="18" rx="2" stroke-width="2"/>
                      <circle cx="8.5" cy="8.5" r="1.5" stroke-width="2"/>
                      <path d="M3 16l5-5 3 3 5-5 3 3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                  <input type="file" id="imageUploadInput" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                </div>
                <button type="button" class="toolbar-btn" onclick="formatText('removeFormat')" title="Clear Formatting">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                    <path d="M12 2v20M2 12h20" stroke-width="2.5" stroke-linecap="round"/>
                    <path d="M6 6l12 12M18 6L6 18" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </button>
              </div>
            </div>
          <div class="rich-text-content" id="abstractEditor" contenteditable="true" data-placeholder="Enter Abstract"></div>
          <textarea id="abstract" name="abstract" required style="display: none;"></textarea>
        </div>
      </div>

      <!-- Terms and Conditions -->
      <div class="checkbox-group">
        <input type="checkbox" id="terms" name="terms" required>
        <label for="terms">By continuing you agree with our Terms and Conditions and Privacy policy.</label>
      </div>

      <!-- Submit Button -->
      <div class="form-actions">
        <button type="submit" class="btn-submit">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
          </svg>
          Submit
        </button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
  // Configure PDF.js worker
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

  // Load countries from API
  async function loadCountries() {
    const countrySelect = document.getElementById('country_of_publication');
    try {
      const response = await fetch('https://restcountries.com/v3.1/all?fields=name,cca2');
      const countries = await response.json();
      
      // Sort countries alphabetically by name
      countries.sort((a, b) => a.name.common.localeCompare(b.name.common));
      
      // Populate dropdown
      countries.forEach(country => {
        const option = document.createElement('option');
        option.value = country.name.common;
        option.textContent = country.name.common;
        countrySelect.appendChild(option);
      });
    } catch (error) {
      console.error('Error loading countries:', error);
      // Fallback to common countries if API fails
      const fallbackCountries = [
        'United States', 'United Kingdom', 'Canada', 'Australia', 'Germany',
        'France', 'Italy', 'Spain', 'Netherlands', 'Sweden', 'Norway',
        'Denmark', 'Finland', 'Switzerland', 'Belgium', 'Austria', 'Poland',
        'Portugal', 'Ireland', 'New Zealand', 'Japan', 'South Korea',
        'China', 'India', 'Brazil', 'Mexico', 'Argentina', 'South Africa'
      ];
      fallbackCountries.forEach(country => {
        const option = document.createElement('option');
        option.value = country;
        option.textContent = country;
        countrySelect.appendChild(option);
      });
    }
  }

  // Rich text editor functions
  function formatText(command, value = null) {
    document.execCommand(command, false, value);
    document.getElementById('abstractEditor').focus();
  }

  function setTextColor() {
    const color = prompt('Enter text color (e.g., #000000 or red):', '#000000');
    if (color) {
      document.execCommand('foreColor', false, color);
    }
    document.getElementById('abstractEditor').focus();
  }

  function setBackgroundColor() {
    const color = prompt('Enter background color (e.g., #ffff00 or yellow):', '#ffff00');
    if (color) {
      document.execCommand('backColor', false, color);
    }
    document.getElementById('abstractEditor').focus();
  }

  function insertLink() {
    const url = prompt('Enter URL:');
    if (url) {
      document.execCommand('createLink', false, url);
    }
    document.getElementById('abstractEditor').focus();
  }

  function openImageDialog() {
    // Open file picker for local upload
    document.getElementById('imageUploadInput').click();
  }

  function insertImage() {
    const url = prompt('Enter image URL:');
    if (url) {
      document.execCommand('insertImage', false, url);
    }
    document.getElementById('abstractEditor').focus();
  }

  function handleImageUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    // Check if file is an image
    if (!file.type.startsWith('image/')) {
      alert('Please select an image file.');
      event.target.value = '';
      return;
    }
    
    // Check file size (max 5MB)
    if (file.size > 5 * 1024 * 1024) {
      alert('Image size must be less than 5MB.');
      event.target.value = '';
      return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
      const imageUrl = e.target.result;
      // Insert image into editor
      document.execCommand('insertImage', false, imageUrl);
      document.getElementById('abstractEditor').focus();
    };
    reader.onerror = function() {
      alert('Error reading image file.');
      event.target.value = '';
    };
    reader.readAsDataURL(file);
    
    // Reset input so same file can be selected again
    event.target.value = '';
  }

  // Sync rich text editor content to hidden textarea
  const abstractEditor = document.getElementById('abstractEditor');
  const abstractTextarea = document.getElementById('abstract');

  abstractEditor.addEventListener('input', function() {
    abstractTextarea.value = this.innerHTML;
  });

  abstractEditor.addEventListener('blur', function() {
    abstractTextarea.value = this.innerHTML;
  });

  // File upload handling with page detection
  async function handleFileSelect(event, type) {
    const file = event.target.files[0];
    const fileNameId = type === 'cover' ? 'coverFileName' : 'fileName';
    const uploadAreaId = type === 'cover' ? 'coverUploadArea' : 'fileUploadArea';
    const fileName = document.getElementById(fileNameId);
    const uploadArea = document.getElementById(uploadAreaId);
    const pageCountDisplay = document.getElementById('pageCountDisplay');
    
    if (file) {
      fileName.textContent = file.name;
      fileName.classList.add('show');
      uploadArea.classList.add('has-file');
      
      // Auto-detect pages for article file
      if (type === 'article') {
        const pagesInput = document.getElementById('pages');
        pagesInput.disabled = true;
        pagesInput.style.backgroundColor = '#f3f4f6';
        
        try {
          if (file.type === 'application/pdf') {
            // Use PDF.js to count pages
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            const numPages = pdf.numPages;
            
            pagesInput.value = `1-${numPages}`;
            pageCountDisplay.textContent = `✓ Auto-detected ${numPages} page(s)`;
            pageCountDisplay.classList.add('show');
            pagesInput.style.backgroundColor = '#d1fae5';
            pagesInput.style.borderColor = '#10b981';
          } else if (file.type === 'application/msword' || file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {
            // Estimate pages for Word documents (rough estimate: 1 page per 500KB)
            const estimatedPages = Math.max(1, Math.ceil(file.size / 500000));
            pagesInput.value = `1-${estimatedPages}`;
            pageCountDisplay.textContent = `✓ Estimated ${estimatedPages} page(s) based on file size`;
            pageCountDisplay.classList.add('show');
            pagesInput.style.backgroundColor = '#d1fae5';
            pagesInput.style.borderColor = '#10b981';
          }
        } catch (error) {
          console.error('Error detecting pages:', error);
          pageCountDisplay.textContent = '⚠ Could not detect page count';
          pageCountDisplay.classList.add('show');
        } finally {
          pagesInput.disabled = false;
        }
      }
    } else {
      fileName.textContent = '';
      fileName.classList.remove('show');
      uploadArea.classList.remove('has-file');
      if (type === 'article' && pageCountDisplay) {
        pageCountDisplay.classList.remove('show');
        const pagesInput = document.getElementById('pages');
        pagesInput.value = '';
        pagesInput.style.backgroundColor = '';
        pagesInput.style.borderColor = '';
      }
    }
  }

  // Drag and drop for file uploads
  ['cover', 'article'].forEach(type => {
    const uploadArea = document.getElementById(type === 'cover' ? 'coverUploadArea' : 'fileUploadArea');
    const fileInput = document.getElementById(type === 'cover' ? 'cover_image' : 'article_file');

    uploadArea.addEventListener('dragover', function(e) {
      e.preventDefault();
      uploadArea.classList.add('drag-over');
    });

    uploadArea.addEventListener('dragleave', function(e) {
      e.preventDefault();
      uploadArea.classList.remove('drag-over');
    });

    uploadArea.addEventListener('drop', function(e) {
      e.preventDefault();
      uploadArea.classList.remove('drag-over');
      
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        if (type === 'cover' && files[0].type.startsWith('image/')) {
          fileInput.files = files;
          handleFileSelect({ target: fileInput }, 'cover');
        } else if (type === 'article' && (files[0].type === 'application/pdf' || files[0].type.includes('word'))) {
          fileInput.files = files;
          handleFileSelect({ target: fileInput }, 'article');
        }
      }
    });
  });

  // Form submission - sync rich text editor
  document.getElementById('articleForm').addEventListener('submit', function(e) {
    // Ensure abstract is synced
    abstractTextarea.value = abstractEditor.innerHTML;
    
    // Validate rich text editor has content
    const editorContent = abstractEditor.textContent.trim() || abstractEditor.innerText.trim();
    if (!editorContent || editorContent.length === 0) {
      e.preventDefault();
      alert('Please enter an abstract.');
      abstractEditor.focus();
      return false;
    }
    
    // Validate required fields
    const title = document.getElementById('title').value.trim();
    const discipline = document.getElementById('discipline').value;
    const keywords = document.getElementById('keywords').value.trim();
    const authorsNames = document.getElementById('authors_names').value.trim();
    const articleFile = document.getElementById('article_file').files[0];
    
    if (!title) {
      e.preventDefault();
      alert('Please enter an article title.');
      document.getElementById('title').focus();
      return false;
    }
    
    if (!discipline) {
      e.preventDefault();
      alert('Please select a subject.');
      document.getElementById('discipline').focus();
      return false;
    }
    
    if (!keywords) {
      e.preventDefault();
      alert('Please enter keywords.');
      document.getElementById('keywords').focus();
      return false;
    }
    
    if (!authorsNames) {
      e.preventDefault();
      alert('Please enter authors names.');
      document.getElementById('authors_names').focus();
      return false;
    }
    
    if (!articleFile) {
      e.preventDefault();
      alert('Please upload an article file.');
      return false;
    }
    
    // Show loading message
    const submitBtn = this.querySelector('.btn-submit');
    if (submitBtn) {
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Submitting...';
    }
  });

  // Load countries when page loads
  document.addEventListener('DOMContentLoaded', function() {
    loadCountries();
    
    // Auto-hide messages after 4 seconds
    const messages = document.querySelectorAll('.message');
    messages.forEach(function(message) {
      setTimeout(function() {
        message.style.animation = 'slideOut 0.3s ease-out';
        setTimeout(function() {
          message.style.display = 'none';
        }, 300);
      }, 4000);
    });
  });
</script>
{% endblock %}
